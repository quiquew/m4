<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guardias 2025-2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #4CAF50;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            min-width: 150px;
        }
        
        .btn:hover {
            background-color: #45a049;
        }
        
        .btn.active {
            background-color: #2c3e50;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            min-width: auto;
        }
        
        .cal-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .cal-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .cal-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
        }
        
        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* CALENDARIO MES */
        .calendar-month {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .calendar-month th {
            background-color: #4CAF50;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ddd;
        }
        
        .calendar-month td {
            padding: 10px;
            border: 1px solid #ddd;
            vertical-align: top;
            height: 120px;
            width: 14.28%;
        }
        
        .day-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        
        .day-number {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            display: block;
        }
        
        .guardia-event {
            background-color: #e8f5e9;
            border-left: 3px solid #4CAF50;
            padding: 5px 8px;
            margin-bottom: 5px;
            border-radius: 3px;
            font-size: 0.85em;
            cursor: pointer;
        }
        
        .guardia-event:hover {
            background-color: #d4edda;
        }
        
        .festivo-day {
            background-color: #ffeaea;
            border-left: 3px solid #e74c3c;
        }
        
        .media-jornada-day {
            background-color: #fff8e1;
            border-left: 3px solid #f39c12;
        }
        
        .vacaciones-day {
            background-color: #e3f2fd;
            border-left: 3px solid #2196f3;
        }
        
        .today {
            background-color: #e8f5e8 !important;
            border: 2px solid #4CAF50 !important;
        }
        
        .other-month {
            background-color: #f8f9fa;
            color: #bdc3c7;
        }
        
        /* CALENDARIO SEMANA */
        .calendar-week {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .calendar-week th {
            background-color: #3498db;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ddd;
            width: 14.28%;
        }
        
        .calendar-week td {
            padding: 10px;
            border: 1px solid #ddd;
            vertical-align: top;
            height: 150px;
        }
        
        .hour-row {
            height: 40px;
        }
        
        .hour-cell {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            width: 80px;
        }
        
        /* PERSONAS */
        .person-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .person-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 5px solid #4CAF50;
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .person-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .person-name {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .person-guardias {
            font-size: 1.1em;
            color: #4CAF50;
            font-weight: bold;
        }
        
        .person-guardias-2025 {
            color: #3498db;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .person-guardias-2026 {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .guardias-list {
            margin-top: 30px;
        }
        
        .guardia-item {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        .guardia-dates {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .guardia-year {
            display: inline-block;
            background-color: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        
        .guardia-year-2025 {
            background-color: #3498db;
        }
        
        .festivo {
            color: #e74c3c;
            font-weight: bold;
            margin-top: 8px;
            padding: 5px 10px;
            background-color: #ffeaea;
            border-radius: 4px;
            display: inline-block;
        }
        
        .media-jornada {
            color: #f39c12;
            font-weight: bold;
            margin-top: 5px;
            padding: 3px 8px;
            background-color: #fff8e1;
            border-radius: 4px;
            display: inline-block;
            font-size: 0.9em;
        }
        
        .vacaciones {
            color: #2196f3;
            font-weight: bold;
            margin-top: 8px;
            padding: 5px 10px;
            background-color: #e3f2fd;
            border-radius: 4px;
            display: inline-block;
        }
        
        .summary-card {
            display: flex;
            justify-content: space-between;
            background: linear-gradient(135deg, #4CAF50, #2c3e50);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .festivos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .festivo-card {
            background-color: #fff5f5;
            border-radius: 8px;
            padding: 20px;
            border-left: 5px solid #e74c3c;
        }
        
        .festivo-date {
            font-size: 1.2em;
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .festivo-name {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .festivo-personas {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .vacaciones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .vacaciones-card {
            background-color: #f0f8ff;
            border-radius: 8px;
            padding: 20px;
            border-left: 5px solid #2196f3;
        }
        
        .vacaciones-date {
            font-size: 1.2em;
            color: #2196f3;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .vacaciones-name {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .vacaciones-persona {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .legend {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        table th, table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        table th {
            background-color: #f2f2f2;
            color: #333;
            font-weight: bold;
        }
        
        table tr:hover {
            background-color: #f5f5f5;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .person-grid {
                grid-template-columns: 1fr;
            }
            
            .summary-card {
                flex-direction: column;
                gap: 20px;
            }
            
            .festivos-grid, .vacaciones-grid {
                grid-template-columns: 1fr;
            }
            
            .calendar-month td {
                height: 80px;
                padding: 5px;
                font-size: 0.9em;
            }
            
            .guardia-event {
                font-size: 0.7em;
                padding: 2px 4px;
            }
            
            .cal-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìÖ Guardias 2025-2026</h1>
            <div class="subtitle">Sistema de visualizaci√≥n de guardias, festivos y vacaciones</div>
        </header>
        
        <div class="controls">
            <button class="btn active" onclick="showSection('resumen')">üìä Resumen</button>
            <button class="btn" onclick="showSection('personas')">üë§ Por Persona</button>
            <button class="btn" onclick="showSection('calendario')">üìÖ Calendario</button>
            <button class="btn" onclick="showSection('hoy')">‚ùì ¬øQui√©n Hoy?</button>
            <button class="btn" onclick="showSection('festivos')">üé™ Festivos</button>
            <button class="btn" onclick="showSection('vacaciones')">üèñÔ∏è Vacaciones</button>
        </div>
        
        <!-- SECCI√ìN RESUMEN -->
        <div id="resumen" class="section active">
            <h2>Resumen General de Guardias</h2>
            <div class="summary-card">
                <div class="summary-item">
                    <div class="summary-number" id="total-guardias-2025">0</div>
                    <div class="summary-label">Guardias 2025</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" id="total-guardias-2026">0</div>
                    <div class="summary-label">Guardias 2026</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" id="total-personas">7</div>
                    <div class="summary-label">Personas</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" id="total-vacaciones">0</div>
                    <div class="summary-label">Per√≠odos vacacionales</div>
                </div>
            </div>
            
            <div class="person-grid" id="resumen-grid">
                <!-- Las tarjetas de personas se generar√°n aqu√≠ -->
            </div>
        </div>
        
        <!-- SECCI√ìN POR PERSONA -->
        <div id="personas" class="section">
            <h2>Selecciona una persona</h2>
            <div class="person-grid" id="personas-grid">
                <!-- Las tarjetas de selecci√≥n se generar√°n aqu√≠ -->
            </div>
            
            <div id="persona-detalle" class="guardias-list" style="display: none;">
                <h3 id="persona-nombre"></h3>
                <div id="persona-lista"></div>
            </div>
        </div>
        
        <!-- SECCI√ìN CALENDARIO -->
        <div id="calendario" class="section">
            <h2>Calendario de Guardias</h2>
            
            <div class="cal-controls">
                <div class="cal-nav">
                    <button class="btn btn-small" onclick="changeView('month')" id="btn-month">üìÖ Mes</button>
                    <button class="btn btn-small" onclick="changeView('week')" id="btn-week">üìÜ Semana</button>
                </div>
                
                <div class="cal-nav">
                    <button class="btn btn-small" onclick="prevPeriod()">‚óÄ Anterior</button>
                    <div class="cal-title" id="calendar-title"></div>
                    <button class="btn btn-small" onclick="nextPeriod()">Siguiente ‚ñ∂</button>
                </div>
                
                <div class="cal-nav">
                    <button class="btn btn-small" onclick="goToday()">Hoy</button>
                    <select class="btn btn-small" id="year-select" onchange="changeYear()" style="background-color: white; color: #333; border: 1px solid #ddd;">
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                    </select>
                </div>
            </div>
            
            <!-- VISTA MES -->
            <div id="month-view" style="display: block;">
                <table class="calendar-month" id="calendar-month">
                    <!-- Calendario mensual se generar√° aqu√≠ -->
                </table>
            </div>
            
            <!-- VISTA SEMANA -->
            <div id="week-view" style="display: none;">
                <table class="calendar-week" id="calendar-week">
                    <!-- Calendario semanal se generar√° aqu√≠ -->
                </table>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e8f5e9; border-left: 3px solid #4CAF50;"></div>
                    <span>Guardia</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffeaea; border-left: 3px solid #e74c3c;"></div>
                    <span>Festivo</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #fff8e1; border-left: 3px solid #f39c12;"></div>
                    <span>Media Jornada</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e3f2fd; border-left: 3px solid #2196f3;"></div>
                    <span>Vacaciones</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e8f5e8; border: 2px solid #4CAF50;"></div>
                    <span>Hoy</span>
                </div>
            </div>
        </div>
        
        <!-- SECCI√ìN QUI√âN HOY -->
        <div id="hoy" class="section">
            <h2>¬øQui√©n tiene guardia hoy?</h2>
            <div id="hoy-content">
                <!-- Contenido din√°mico -->
            </div>
        </div>
        
        <!-- SECCI√ìN FESTIVOS -->
        <div id="festivos" class="section">
            <h2>Festivos durante guardias</h2>
            <div class="festivos-grid" id="festivos-grid">
                <!-- Tarjetas de festivos -->
            </div>
            
            <h3 style="margin-top: 40px;">Personas m√°s afectadas por festivos</h3>
            <table>
                <thead>
                    <tr>
                        <th>Persona</th>
                        <th>Festivos 2025</th>
                        <th>Festivos 2026</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="festivos-ranking">
                    <!-- Ranking de personas -->
                </tbody>
            </table>
        </div>
        
        <!-- SECCI√ìN VACACIONES -->
        <div id="vacaciones" class="section">
            <h2>Per√≠odos vacacionales</h2>
            <div class="vacaciones-grid" id="vacaciones-grid">
                <!-- Tarjetas de vacaciones se generar√°n aqu√≠ -->
            </div>
            
            <div id="vacaciones-message" style="text-align: center; padding: 40px; color: #7f8c8d; display: none;">
                No hay per√≠odos vacacionales registrados actualmente.
            </div>
        </div>
    </div>

    <script>
        // Datos de las guardias
        const GUARDIAS = {
            "QUIQUE": [
                ["2025-12-31", "2026-01-01"],  // Incluye 1 enero y media jornada 31
				["2026-01-01", "2026-01-06"],
                ["2026-02-11", "2026-02-17"],
                ["2026-03-18", "2026-03-24"],  // Incluye 19 marzo (San Jos√©)
                ["2026-05-20", "2026-05-26"],
                ["2026-07-22", "2026-07-28"],
                ["2026-09-02", "2026-09-08"],
                ["2026-10-28", "2026-11-03"],
                ["2026-11-25", "2026-12-01"],
            ],
            "DANI": [
                ["2025-12-24", "2025-12-30"],  // Nueva guardia 2025 - Incluye Navidad
                ["2026-01-07", "2026-01-13"],
                ["2026-04-01", "2026-04-07"],
                ["2026-05-13", "2026-05-19"],
                ["2026-07-01", "2026-07-07"],
                ["2026-08-05", "2026-08-11"],
                ["2026-10-21", "2026-10-27"],
                ["2026-12-09", "2026-12-15"],
            ],
            "RICARDO": [
                ["2026-01-14", "2026-01-20"],
                ["2026-02-18", "2026-02-24"],
                ["2026-04-22", "2026-04-28"],  // Incluye San Vicente Ferrer (16/4) y Semana Santa (3/4)
                ["2026-06-10", "2026-06-16"],
                ["2026-07-15", "2026-07-21"],
                ["2026-08-12", "2026-08-18"],  // Cerca de Asunci√≥n (15/8)
                ["2026-09-23", "2026-09-29"],
                ["2026-11-11", "2026-11-17"],
                ["2026-12-16", "2026-12-22"],
            ],
            "JONA": [
                ["2025-12-10", "2025-12-16"],  // Nueva guardia 2025
                ["2026-01-21", "2026-01-27"],
                ["2026-02-25", "2026-03-03"],
                ["2026-04-08", "2026-04-14"],
                ["2026-06-17", "2026-06-23"],  // Cerca de San Juan (24/6)
                ["2026-08-19", "2026-08-25"],
                ["2026-09-30", "2026-10-06"],
            ],
            "PEDRO": [
                ["2025-12-17", "2025-12-23"],  // Nueva guardia 2025
                ["2026-01-28", "2026-02-03"],
                ["2026-03-04", "2026-03-10"],
                ["2026-04-29", "2026-05-05"],
                ["2026-06-24", "2026-06-30"],  // Incluye San Juan (24/6)
                ["2026-09-09", "2026-09-15"],
                ["2026-10-07", "2026-10-13"],
                ["2026-11-18", "2026-11-24"],
            ],
            "MIGUEL": [
                ["2026-02-04", "2026-02-10"],
                ["2026-03-25", "2026-03-31"],
                ["2026-05-06", "2026-05-12"],
                ["2026-06-03", "2026-06-09"],
                ["2026-07-29", "2026-08-04"],
                ["2026-08-26", "2026-09-01"],
                ["2026-10-14", "2026-10-20"],
                ["2026-12-02", "2026-12-08"],
            ],
            "ANDREU": [
                ["2026-03-11", "2026-03-17"],
                ["2026-04-15", "2026-04-21"],
                ["2026-05-27", "2026-05-02"],
                ["2026-07-08", "2026-07-14"],
                ["2026-09-16", "2026-09-22"],
                ["2026-11-04", "2026-11-10"],
                ["2026-12-23", "2026-12-29"],
            ]
        };

        // Festivos de Valencia (2025-2026) actualizados
        const FESTIVOS_VALENCIA = {
            // 2025
            "2025-12-24": "Nochebuena (media jornada)",
            "2025-12-25": "Navidad",
            "2025-12-31": "Nochevieja (media jornada)",
            
            // 2026
            "2026-01-01": "A√±o Nuevo",
            "2026-01-06": "Epifan√≠a Reyes",
            "2026-01-22": "San Vicente M√°rtir",
            "2026-03-19": "San Jos√©",
            "2026-04-03": "Viernes Santo",
            "2026-04-16": "San Vicente Ferrer",
            "2026-06-24": "San Juan",
            "2026-08-15": "Asunci√≥n de la Virgen",
            "2026-10-09": "D√≠a de la Cominidad Valenciana",
            "2026-10-12": "D√≠a de la Hispanidad",
            "2026-11-01": "D√≠a de todos los santos",
            "2026-12-06": "D√≠a de la constituci√≥n",
            "2026-12-08": "D√≠a de la Inmaculada Concepci√≥n",
            "2026-12-25": "Navidad"
        };

        // D√≠as de media jornada
        const MEDIA_JORNADA = {
            "2025-12-24": "Nochebuena",
            "2025-12-31": "Nochevieja"
        };

        // VACACIONES - Estructura para a√±adir per√≠odos vacacionales
        const VACACIONES = {
            "PEDRO": [
                ["2026-07-06", "2026-07-26", "Vacaciones verano"]
            ]
        };

        // Variables para el calendario
        let currentDate = new Date();
        let currentView = 'month'; // 'month' o 'week'
        let currentYear = currentDate.getFullYear();
        let currentMonth = currentDate.getMonth();

        // Funciones de utilidad
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function getYearFromDate(dateStr) {
            return new Date(dateStr).getFullYear();
        }

        function getFestivosEnGuardia(inicioStr, finStr) {
            const festivos = [];
            const inicio = new Date(inicioStr);
            const fin = new Date(finStr);
            
            let currentDate = new Date(inicio);
            while (currentDate <= fin) {
                const fechaStr = currentDate.toISOString().split('T')[0];
                if (FESTIVOS_VALENCIA[fechaStr]) {
                    festivos.push({
                        fecha: formatDate(fechaStr),
                        nombre: FESTIVOS_VALENCIA[fechaStr],
                        fechaStr: fechaStr
                    });
                }
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return festivos;
        }

        function getMediaJornadaEnGuardia(inicioStr, finStr) {
            const mediaJornadas = [];
            const inicio = new Date(inicioStr);
            const fin = new Date(finStr);
            
            let currentDate = new Date(inicio);
            while (currentDate <= fin) {
                const fechaStr = currentDate.toISOString().split('T')[0];
                if (MEDIA_JORNADA[fechaStr]) {
                    mediaJornadas.push({
                        fecha: formatDate(fechaStr),
                        nombre: MEDIA_JORNADA[fechaStr]
                    });
                }
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return mediaJornadas;
        }

        function getVacacionesParaPersona(persona) {
            if (VACACIONES[persona]) {
                return VACACIONES[persona];
            }
            return [];
        }

        function quienTieneGuardiaHoy() {
            const hoy = new Date();
            const hoyStr = hoy.toISOString().split('T')[0];
            
            for (const [persona, guardias] of Object.entries(GUARDIAS)) {
                for (const [inicio, fin] of guardias) {
                    if (inicio <= hoyStr && hoyStr <= fin) {
                        return { persona, inicio, fin };
                    }
                }
            }
            
            return null;
        }

        function getGuardiasPorA√±o(persona) {
            const guardias2025 = [];
            const guardias2026 = [];
            
            if (GUARDIAS[persona]) {
                GUARDIAS[persona].forEach(([inicio, fin]) => {
                    const a√±o = getYearFromDate(inicio);
                    if (a√±o === 2025) {
                        guardias2025.push([inicio, fin]);
                    } else if (a√±o === 2026) {
                        guardias2026.push([inicio, fin]);
                    }
                });
            }
            
            return { guardias2025, guardias2026 };
        }

        // FUNCIONES DEL CALENDARIO
        function changeView(view) {
            currentView = view;
            
            // Actualizar botones
            document.getElementById('btn-month').classList.toggle('active', view === 'month');
            document.getElementById('btn-week').classList.toggle('active', view === 'week');
            
            // Mostrar/ocultar vistas
            document.getElementById('month-view').style.display = view === 'month' ? 'block' : 'none';
            document.getElementById('week-view').style.display = view === 'week' ? 'block' : 'none';
            
            // Actualizar calendario
            updateCalendar();
        }

        function prevPeriod() {
            if (currentView === 'month') {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
            } else {
                // Para semana: retroceder 7 d√≠as
                currentDate.setDate(currentDate.getDate() - 7);
                currentYear = currentDate.getFullYear();
                currentMonth = currentDate.getMonth();
            }
            updateCalendar();
        }

        function nextPeriod() {
            if (currentView === 'month') {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
            } else {
                // Para semana: avanzar 7 d√≠as
                currentDate.setDate(currentDate.getDate() + 7);
                currentYear = currentDate.getFullYear();
                currentMonth = currentDate.getMonth();
            }
            updateCalendar();
        }

        function goToday() {
            currentDate = new Date();
            currentYear = currentDate.getFullYear();
            currentMonth = currentDate.getMonth();
            updateCalendar();
        }

        function changeYear() {
            const yearSelect = document.getElementById('year-select');
            currentYear = parseInt(yearSelect.value);
            updateCalendar();
        }

        function updateCalendar() {
            // Actualizar t√≠tulo
            const title = document.getElementById('calendar-title');
            const yearSelect = document.getElementById('year-select');
            
            yearSelect.value = currentYear;
            
            if (currentView === 'month') {
                const monthNames = [
                    "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
                    "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
                ];
                title.textContent = `${monthNames[currentMonth]} ${currentYear}`;
                renderMonthCalendar();
            } else {
                renderWeekCalendar();
            }
        }

        function renderMonthCalendar() {
            const calendar = document.getElementById('calendar-month');
            const hoy = new Date();
            const hoyStr = hoy.toISOString().split('T')[0];
            
            // Obtener primer d√≠a del mes
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            
            // D√≠as de la semana en espa√±ol
            const daysOfWeek = ["Dom", "Lun", "Mar", "Mi√©", "Jue", "Vie", "S√°b"];
            
            // Crear encabezado
            let html = '<thead><tr>';
            daysOfWeek.forEach(day => {
                html += `<th>${day}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            // Calcular d√≠a de inicio (0 = domingo, 1 = lunes, etc.)
            let startDay = firstDay.getDay();
            
            // Calcular total de d√≠as del mes
            const totalDays = lastDay.getDate();
            
            // Calcular celdas vac√≠as al inicio
            let dayCounter = 1;
            let htmlRows = '';
            
            for (let i = 0; i < 6; i++) { // M√°ximo 6 semanas
                htmlRows += '<tr>';
                
                for (let j = 0; j < 7; j++) {
                    const dayNumber = (i * 7) + j - startDay + 1;
                    
                    if (dayNumber < 1 || dayNumber > totalDays) {
                        // Celda vac√≠a (mes anterior o siguiente)
                        const prevMonth = currentMonth === 0 ? 11 : currentMonth - 1;
                        const prevYear = currentMonth === 0 ? currentYear - 1 : currentYear;
                        const nextMonth = currentMonth === 11 ? 0 : currentMonth + 1;
                        const nextYear = currentMonth === 11 ? currentYear + 1 : currentYear;
                        
                        let date;
                        if (dayNumber < 1) {
                            // Mes anterior
                            const prevLastDay = new Date(currentYear, currentMonth, 0).getDate();
                            date = new Date(prevYear, prevMonth, prevLastDay + dayNumber);
                        } else {
                            // Mes siguiente
                            date = new Date(nextYear, nextMonth, dayNumber - totalDays);
                        }
                        
                        const dateStr = date.toISOString().split('T')[0];
                        htmlRows += `<td class="other-month">
                            <div class="day-number">${date.getDate()}</div>
                            ${getEventsForDay(dateStr)}
                        </td>`;
                    } else {
                        // D√≠a del mes actual
                        const date = new Date(currentYear, currentMonth, dayNumber);
                        const dateStr = date.toISOString().split('T')[0];
                        const isToday = dateStr === hoyStr;
                        
                        let cellClass = '';
                        if (isToday) cellClass = 'today';
                        if (FESTIVOS_VALENCIA[dateStr]) cellClass += ' festivo-day';
                        if (MEDIA_JORNADA[dateStr]) cellClass += ' media-jornada-day';
                        if (esDiaDeVacaciones(dateStr)) cellClass += ' vacaciones-day';
                        
                        htmlRows += `<td${cellClass ? ` class="${cellClass.trim()}"` : ''}>
                            <div class="day-number">${dayNumber}</div>
                            ${getEventsForDay(dateStr)}
                        </td>`;
                        
                        dayCounter++;
                    }
                }
                
                htmlRows += '</tr>';
                
                // Si ya hemos mostrado todos los d√≠as, salir
                if (dayCounter > totalDays) break;
            }
            
            html += htmlRows + '</tbody>';
            calendar.innerHTML = html;
        }

        function esDiaDeVacaciones(dateStr) {
            for (const [persona, vacaciones] of Object.entries(VACACIONES)) {
                for (const [inicio, fin] of vacaciones) {
                    if (dateStr >= inicio && dateStr <= fin) {
                        return true;
                    }
                }
            }
            return false;
        }

        function renderWeekCalendar() {
            const calendar = document.getElementById('calendar-week');
            const hoy = new Date();
            const hoyStr = hoy.toISOString().split('T')[0];
            
            // Encontrar el lunes de la semana actual
            const monday = new Date(currentDate);
            monday.setDate(currentDate.getDate() - currentDate.getDay() + (currentDate.getDay() === 0 ? -6 : 1));
            
            // Actualizar t√≠tulo
            const title = document.getElementById('calendar-title');
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            
            const monthNames = [
                "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
                "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
            ];
            
            title.textContent = `Semana ${monday.getDate()}-${sunday.getDate()} de ${monthNames[monday.getMonth()]} ${monday.getFullYear()}`;
            
            // D√≠as de la semana
            const daysOfWeek = ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes", "S√°bado", "Domingo"];
            
            // Crear encabezado
            let html = '<thead><tr><th class="hour-cell">Hora</th>';
            
            // Crear columnas para cada d√≠a
            const weekDates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);
                weekDates.push(date);
                
                const dateStr = date.toISOString().split('T')[0];
                const isToday = dateStr === hoyStr;
                
                let dayClass = '';
                if (isToday) dayClass = 'today';
                
                html += `<th${dayClass ? ` class="${dayClass}"` : ''}>
                    <div>${daysOfWeek[i]}</div>
                    <div>${date.getDate()}/${date.getMonth() + 1}</div>
                </th>`;
            }
            
            html += '</tr></thead><tbody>';
            
            // Crear filas para el d√≠a (sin horas espec√≠ficas, solo eventos del d√≠a)
            html += '<tr>';
            html += '<td class="hour-cell">Todo el d√≠a</td>';
            
            for (let i = 0; i < 7; i++) {
                const date = weekDates[i];
                const dateStr = date.toISOString().split('T')[0];
                
                let cellClass = '';
                if (dateStr === hoyStr) cellClass = 'today';
                if (FESTIVOS_VALENCIA[dateStr]) cellClass += ' festivo-day';
                if (MEDIA_JORNADA[dateStr]) cellClass += ' media-jornada-day';
                if (esDiaDeVacaciones(dateStr)) cellClass += ' vacaciones-day';
                
                html += `<td${cellClass ? ` class="${cellClass.trim()}"` : ''}>
                    ${getEventsForDay(dateStr)}
                </td>`;
            }
            
            html += '</tr></tbody>';
            calendar.innerHTML = html;
        }

        function getEventsForDay(dateStr) {
            let events = '';
            
            // Buscar guardias para este d√≠a
            for (const [persona, guardias] of Object.entries(GUARDIAS)) {
                for (const [inicio, fin] of guardias) {
                    if (dateStr >= inicio && dateStr <= fin) {
                        // Verificar si es festivo o media jornada
                        let eventClass = 'guardia-event';
                        if (FESTIVOS_VALENCIA[dateStr]) {
                            eventClass += ' festivo-day';
                        } else if (MEDIA_JORNADA[dateStr]) {
                            eventClass += ' media-jornada-day';
                        } else if (esDiaDeVacacionesParaPersona(persona, dateStr)) {
                            eventClass += ' vacaciones-day';
                        }
                        
                        events += `<div class="${eventClass}" title="${persona}: ${formatDate(inicio)} - ${formatDate(fin)}">${persona}</div>`;
                        break; // Solo mostrar una vez por persona
                    }
                }
            }
            
            // Buscar vacaciones para este d√≠a (solo si no hay guardia de esa persona)
            for (const [persona, vacaciones] of Object.entries(VACACIONES)) {
                for (const [inicio, fin, descripcion] of vacaciones) {
                    if (dateStr >= inicio && dateStr <= fin && !events.includes(persona)) {
                        events += `<div class="guardia-event vacaciones-day" title="${persona}: ${descripcion}">${persona} üèñÔ∏è</div>`;
                        break;
                    }
                }
            }
            
            // A√±adir indicador de festivo si no hay guardia
            if (FESTIVOS_VALENCIA[dateStr] && !events.includes('festivo-day')) {
                events += `<div class="guardia-event festivo-day" title="${FESTIVOS_VALENCIA[dateStr]}">${FESTIVOS_VALENCIA[dateStr]}</div>`;
            }
            
            // A√±adir indicador de media jornada
            if (MEDIA_JORNADA[dateStr] && !events.includes('media-jornada-day')) {
                events += `<div class="guardia-event media-jornada-day" title="${MEDIA_JORNADA[dateStr]}">${MEDIA_JORNADA[dateStr]}</div>`;
            }
            
            return events;
        }

        function esDiaDeVacacionesParaPersona(persona, dateStr) {
            if (VACACIONES[persona]) {
                for (const [inicio, fin] of VACACIONES[persona]) {
                    if (dateStr >= inicio && dateStr <= fin) {
                        return true;
                    }
                }
            }
            return false;
        }

        // Funciones de la interfaz
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar la secci√≥n seleccionada
            document.getElementById(sectionId).classList.add('active');
            
            // Actualizar botones activos
            document.querySelectorAll('.btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Cargar datos de la secci√≥n
            switch(sectionId) {
                case 'resumen':
                    cargarResumen();
                    break;
                case 'personas':
                    cargarPersonas();
                    break;
                case 'calendario':
                    cargarCalendario();
                    break;
                case 'hoy':
                    cargarHoy();
                    break;
                case 'festivos':
                    cargarFestivos();
                    break;
                case 'vacaciones':
                    cargarVacaciones();
                    break;
            }
        }

        function cargarCalendario() {
            // Configurar a√±o actual
            document.getElementById('year-select').value = currentYear;
            
            // Actualizar calendario
            updateCalendar();
        }

        function cargarResumen() {
            let totalGuardias2025 = 0;
            let totalGuardias2026 = 0;
            const resumenGrid = document.getElementById('resumen-grid');
            
            resumenGrid.innerHTML = '';
            
            // Calcular totales
            for (const [persona, guardias] of Object.entries(GUARDIAS)) {
                let guardias2025 = 0;
                let guardias2026 = 0;
                
                // Contar TODAS las guardias por a√±o
                guardias.forEach(([inicio, fin]) => {
                    const a√±o = getYearFromDate(inicio);
                    if (a√±o === 2025) {
                        guardias2025++;
                        totalGuardias2025++;
                    } else if (a√±o === 2026) {
                        guardias2026++;
                        totalGuardias2026++;
                    }
                });
                
                // Obtener vacaciones de la persona
                const vacacionesPersona = getVacacionesParaPersona(persona);
                
                // Crear tarjeta
                const card = document.createElement('div');
                card.className = 'person-card';
                card.innerHTML = `
                    <div class="person-name">${persona}</div>
                    <div class="person-guardias">${guardias2025 + guardias2026} guardias total</div>
                    ${guardias2025 > 0 ? `<div class="person-guardias-2025">${guardias2025} en 2025</div>` : ''}
                    ${guardias2026 > 0 ? `<div class="person-guardias-2026">${guardias2026} en 2026</div>` : ''}
                    ${vacacionesPersona.length > 0 ? `<div style="color: #2196f3; font-size: 0.9em; margin-top: 5px;">üèñÔ∏è ${vacacionesPersona.length} per√≠odo(s) vacacional(es)</div>` : ''}
                `;
                card.onclick = () => mostrarDetallePersona(persona);
                resumenGrid.appendChild(card);
            }
            
            // Calcular total de per√≠odos vacacionales
            let totalVacaciones = 0;
            for (const persona in VACACIONES) {
                totalVacaciones += VACACIONES[persona].length;
            }
            
            // Actualizar n√∫meros
            document.getElementById('total-guardias-2025').textContent = totalGuardias2025;
            document.getElementById('total-guardias-2026').textContent = totalGuardias2026;
            document.getElementById('total-personas').textContent = Object.keys(GUARDIAS).length;
            document.getElementById('total-vacaciones').textContent = totalVacaciones;
        }

        function cargarPersonas() {
            const personasGrid = document.getElementById('personas-grid');
            
            personasGrid.innerHTML = '';
            
            for (const persona of Object.keys(GUARDIAS)) {
                let guardias2025 = 0;
                let guardias2026 = 0;
                
                // Contar TODAS las guardias por a√±o
                GUARDIAS[persona].forEach(([inicio, fin]) => {
                    const a√±o = getYearFromDate(inicio);
                    if (a√±o === 2025) guardias2025++;
                    else if (a√±o === 2026) guardias2026++;
                });
                
                const vacacionesPersona = getVacacionesParaPersona(persona);
                
                const card = document.createElement('div');
                card.className = 'person-card';
                card.innerHTML = `
                    <div class="person-name">${persona}</div>
                    <div class="person-guardias">${guardias2025 + guardias2026} guardias</div>
                    ${guardias2025 > 0 ? `<div class="person-guardias-2025">${guardias2025} en 2025</div>` : ''}
                    ${guardias2026 > 0 ? `<div class="person-guardias-2026">${guardias2026} en 2026</div>` : ''}
                    ${vacacionesPersona.length > 0 ? `<div style="color: #2196f3; font-size: 0.9em; margin-top: 5px;">üèñÔ∏è ${vacacionesPersona.length} per√≠odo(s) vacacional(es)</div>` : ''}
                `;
                card.onclick = () => mostrarDetallePersona(persona);
                personasGrid.appendChild(card);
            }
        }

        function mostrarDetallePersona(persona) {
            const { guardias2025, guardias2026 } = getGuardiasPorA√±o(persona);
            const vacacionesPersona = getVacacionesParaPersona(persona);
            const lista = document.getElementById('persona-lista');
            const detalle = document.getElementById('persona-detalle');
            
            document.getElementById('persona-nombre').textContent = `Detalles de ${persona}`;
            lista.innerHTML = '';
            
            // Mostrar guardias 2025
            if (guardias2025.length > 0) {
                const titulo2025 = document.createElement('h4');
                titulo2025.textContent = 'Guardias 2025';
                titulo2025.style.color = '#3498db';
                titulo2025.style.marginTop = '20px';
                lista.appendChild(titulo2025);
                
                guardias2025.forEach(([inicio, fin], index) => {
                    const festivos = getFestivosEnGuardia(inicio, fin);
                    const mediaJornadas = getMediaJornadaEnGuardia(inicio, fin);
                    const item = document.createElement('div');
                    item.className = 'guardia-item';
                    
                    let festivosHTML = '';
                    if (festivos.length > 0) {
                        festivosHTML = '<div style="margin-top: 10px;">';
                        festivos.forEach(festivo => {
                            festivosHTML += `<div class="festivo">üé™ ${festivo.fecha}: ${festivo.nombre}</div>`;
                        });
                        festivosHTML += '</div>';
                    }
                    
                    let mediaJornadaHTML = '';
                    if (mediaJornadas.length > 0) {
                        mediaJornadaHTML = '<div style="margin-top: 5px;">';
                        mediaJornadas.forEach(mj => {
                            mediaJornadaHTML += `<div class="media-jornada">‚è∞ ${mj.fecha}: ${mj.nombre} (media jornada)</div>`;
                        });
                        mediaJornadaHTML += '</div>';
                    }
                    
                    item.innerHTML = `
                        <div class="guardia-dates">
                            ${index + 1}. ${formatDate(inicio)} al ${formatDate(fin)}
                            <span class="guardia-year guardia-year-2025">2025</span>
                        </div>
                        ${festivosHTML}
                        ${mediaJornadaHTML}
                    `;
                    lista.appendChild(item);
                });
            }
            
            // Mostrar guardias 2026
            if (guardias2026.length > 0) {
                const titulo2026 = document.createElement('h4');
                titulo2026.textContent = 'Guardias 2026';
                titulo2026.style.color = '#e74c3c';
                titulo2026.style.marginTop = '20px';
                lista.appendChild(titulo2026);
                
                guardias2026.forEach(([inicio, fin], index) => {
                    const festivos = getFestivosEnGuardia(inicio, fin);
                    const item = document.createElement('div');
                    item.className = 'guardia-item';
                    
                    let festivosHTML = '';
                    if (festivos.length > 0) {
                        festivosHTML = '<div style="margin-top: 10px;">';
                        festivos.forEach(festivo => {
                            festivosHTML += `<div class="festivo">üé™ ${festivo.fecha}: ${festivo.nombre}</div>`;
                        });
                        festivosHTML += '</div>';
                    }
                    
                    item.innerHTML = `
                        <div class="guardia-dates">
                            ${index + 1}. ${formatDate(inicio)} al ${formatDate(fin)}
                            <span class="guardia-year">2026</span>
                        </div>
                        ${festivosHTML}
                    `;
                    lista.appendChild(item);
                });
            }
            
            // Mostrar vacaciones
            if (vacacionesPersona.length > 0) {
                const tituloVacaciones = document.createElement('h4');
                tituloVacaciones.textContent = 'Per√≠odos Vacacionales';
                tituloVacaciones.style.color = '#2196f3';
                tituloVacaciones.style.marginTop = '20px';
                lista.appendChild(tituloVacaciones);
                
                vacacionesPersona.forEach(([inicio, fin, descripcion], index) => {
                    const item = document.createElement('div');
                    item.className = 'guardia-item';
                    item.style.borderLeftColor = '#2196f3';
                    
                    item.innerHTML = `
                        <div class="guardia-dates">
                            ${index + 1}. ${formatDate(inicio)} al ${formatDate(fin)}
                            <span style="background-color: #2196f3; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; margin-left: 10px;">üèñÔ∏è VACACIONES</span>
                        </div>
                        <div class="vacaciones" style="margin-top: 8px;">${descripcion || 'Vacaciones'}</div>
                    `;
                    lista.appendChild(item);
                });
            }
            
            if (guardias2025.length === 0 && guardias2026.length === 0 && vacacionesPersona.length === 0) {
                lista.innerHTML = '<div style="text-align: center; padding: 20px; color: #7f8c8d;">No hay guardias ni vacaciones asignadas</div>';
            }
            
            // Ocultar grid y mostrar detalle
            document.getElementById('personas-grid').style.display = 'none';
            detalle.style.display = 'block';
            
            // Agregar bot√≥n para volver
            if (!document.getElementById('btn-volver')) {
                const btnVolver = document.createElement('button');
                btnVolver.id = 'btn-volver';
                btnVolver.className = 'btn';
                btnVolver.textContent = '‚Üê Volver al listado';
                btnVolver.onclick = () => {
                    detalle.style.display = 'none';
                    document.getElementById('personas-grid').style.display = 'grid';
                };
                detalle.insertBefore(btnVolver, lista);
            }
        }

        function cargarHoy() {
            const hoyContent = document.getElementById('hoy-content');
            const hoy = new Date();
            const hoyStr = hoy.toISOString().split('T')[0];
            const hoyFormateado = formatDate(hoyStr);
            
            const guardiaHoy = quienTieneGuardiaHoy();
            
            let contenido = `
                <div style="text-align: center; padding: 30px;">
                    <div style="font-size: 1.2em; margin-bottom: 20px; color: #7f8c8d;">
                        Fecha: ${hoyFormateado}
                    </div>
            `;
            
            if (guardiaHoy) {
                const festivosHoy = FESTIVOS_VALENCIA[hoyStr] ? `<div class="festivo" style="margin: 15px 0;">üé™ ¬°Hoy es festivo!: ${FESTIVOS_VALENCIA[hoyStr]}</div>` : '';
                const mediaJornadaHoy = MEDIA_JORNADA[hoyStr] ? `<div class="media-jornada" style="margin: 10px 0;">‚è∞ Hoy: ${MEDIA_JORNADA[hoyStr]} (media jornada)</div>` : '';
                const festivosGuardia = getFestivosEnGuardia(guardiaHoy.inicio, guardiaHoy.fin);
                const mediaJornadasGuardia = getMediaJornadaEnGuardia(guardiaHoy.inicio, guardiaHoy.fin);
                
                // Verificar si la persona tiene vacaciones hoy
                const personaVacaciones = VACACIONES[guardiaHoy.persona] || [];
                let vacacionesHoy = '';
                for (const [inicio, fin, descripcion] of personaVacaciones) {
                    if (hoyStr >= inicio && hoyStr <= fin) {
                        vacacionesHoy = `<div class="vacaciones" style="margin: 15px 0;">üèñÔ∏è ${guardiaHoy.persona} est√° de vacaciones hoy: ${descripcion || 'Vacaciones'}</div>`;
                        break;
                    }
                }
                
                let festivosGuardiaHTML = '';
                if (festivosGuardia.length > 0) {
                    festivosGuardiaHTML = '<div style="margin-top: 20px;"><strong>Festivos en esta guardia:</strong><br>';
                    festivosGuardia.forEach(festivo => {
                        festivosGuardiaHTML += `<div style="color: #e74c3c; margin-top: 5px;">‚Ä¢ ${festivo.fecha}: ${festivo.nombre}</div>`;
                    });
                    festivosGuardiaHTML += '</div>';
                }
                
                let mediaJornadasHTML = '';
                if (mediaJornadasGuardia.length > 0) {
                    mediaJornadasHTML = '<div style="margin-top: 15px;"><strong>D√≠as de media jornada:</strong><br>';
                    mediaJornadasGuardia.forEach(mj => {
                        mediaJornadasHTML += `<div style="color: #f39c12; margin-top: 5px;">‚Ä¢ ${mj.fecha}: ${mj.nombre}</div>`;
                    });
                    mediaJornadasHTML += '</div>';
                }
                
                contenido += `
                    <div style="background-color: #e8f5e8; padding: 30px; border-radius: 10px; margin-top: 20px;">
                        <div style="font-size: 2em; color: #2c3e50; margin-bottom: 10px;">
                            ‚úÖ ${guardiaHoy.persona} tiene guardia hoy
                        </div>
                        <div style="font-size: 1.3em; color: #4CAF50; margin-bottom: 20px;">
                            Per√≠odo: ${formatDate(guardiaHoy.inicio)} al ${formatDate(guardiaHoy.fin)}
                        </div>
                        ${festivosHoy}
                        ${mediaJornadaHoy}
                        ${vacacionesHoy}
                        ${festivosGuardiaHTML}
                        ${mediaJornadasHTML}
                    </div>
                `;
            } else {
                // Buscar pr√≥xima guardia
                let proximaGuardia = null;
                let diasFaltan = null;
                
                for (const [persona, guardias] of Object.entries(GUARDIAS)) {
                    for (const [inicio, fin] of guardias) {
                        const inicioDate = new Date(inicio);
                        if (inicioDate > hoy) {
                            const dias = Math.ceil((inicioDate - hoy) / (1000 * 60 * 60 * 24));
                            if (!proximaGuardia || inicioDate < new Date(proximaGuardia.inicio)) {
                                proximaGuardia = { persona, inicio, fin };
                                diasFaltan = dias;
                            }
                        }
                    }
                }
                
                let proximaInfo = '';
                if (proximaGuardia) {
                    const festivosGuardia = getFestivosEnGuardia(proximaGuardia.inicio, proximaGuardia.fin);
                    let festivosHTML = '';
                    
                    if (festivosGuardia.length > 0) {
                        festivosHTML = '<div style="margin-top: 10px;"><strong>Festivos:</strong><br>';
                        festivosGuardia.forEach(festivo => {
                            festivosHTML += `<div style="color: #e74c3c;">‚Ä¢ ${festivo.fecha}: ${festivo.nombre}</div>`;
                        });
                        festivosHTML += '</div>';
                    }
                    
                    proximaInfo = `
                        <div style="background-color: #f0f8ff; padding: 20px; border-radius: 10px; margin-top: 20px;">
                            <div style="font-size: 1.3em; color: #3498db; margin-bottom: 10px;">
                                üìÖ PR√ìXIMA GUARDIA
                            </div>
                            <div style="font-size: 1.1em;">
                                <strong>Persona:</strong> ${proximaGuardia.persona}<br>
                                <strong>Fecha:</strong> ${formatDate(proximaGuardia.inicio)} al ${formatDate(proximaGuardia.fin)}<br>
                                <strong>Faltan:</strong> ${diasFaltan} d√≠as
                                ${festivosHTML}
                            </div>
                        </div>
                    `;
                }
                
                contenido += `
                    <div style="background-color: #fff3cd; padding: 30px; border-radius: 10px; margin-top: 20px;">
                        <div style="font-size: 1.8em; color: #856404; margin-bottom: 10px;">
                            ‚ÑπÔ∏è Nadie tiene guardia hoy
                        </div>
                        ${proximaInfo}
                    </div>
                `;
            }
            
            contenido += '</div>';
            hoyContent.innerHTML = contenido;
        }

        function cargarFestivos() {
            const festivosGrid = document.getElementById('festivos-grid');
            const rankingBody = document.getElementById('festivos-ranking');
            
            festivosGrid.innerHTML = '';
            rankingBody.innerHTML = '';
            
            // Agrupar festivos por persona y a√±o
            const festivosConGuardia = {};
            const contadorFestivos2025 = {};
            const contadorFestivos2026 = {};
            
            // Inicializar contadores
            for (const persona of Object.keys(GUARDIAS)) {
                contadorFestivos2025[persona] = 0;
                contadorFestivos2026[persona] = 0;
            }
            
            // Procesar festivos
            for (const [fecha, nombre] of Object.entries(FESTIVOS_VALENCIA)) {
                const a√±o = getYearFromDate(fecha);
                
                for (const [persona, guardias] of Object.entries(GUARDIAS)) {
                    for (const [inicio, fin] of guardias) {
                        if (inicio <= fecha && fecha <= fin) {
                            if (!festivosConGuardia[fecha]) {
                                festivosConGuardia[fecha] = {
                                    nombre: nombre,
                                    personas: [],
                                    a√±o: a√±o
                                };
                            }
                            festivosConGuardia[fecha].personas.push(persona);
                            
                            if (a√±o === 2025) {
                                contadorFestivos2025[persona]++;
                            } else if (a√±o === 2026) {
                                contadorFestivos2026[persona]++;
                            }
                            break;
                        }
                    }
                }
            }
            
            // Mostrar festivos en tarjetas
            for (const [fecha, datos] of Object.entries(festivosConGuardia)) {
                const card = document.createElement('div');
                card.className = 'festivo-card';
                card.innerHTML = `
                    <div class="festivo-date">${formatDate(fecha)} (${datos.a√±o})</div>
                    <div class="festivo-name">${datos.nombre}</div>
                    <div class="festivo-personas">
                        <strong>Tiene guardia:</strong> ${datos.personas.join(', ')}
                    </div>
                `;
                festivosGrid.appendChild(card);
            }
            
            if (Object.keys(festivosConGuardia).length === 0) {
                festivosGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: #7f8c8d; grid-column: 1 / -1;">No hay festivos durante guardias</div>';
            }
            
            // Mostrar ranking
            const ranking = Object.entries(contadorFestivos2025)
                .map(([persona, count2025]) => {
                    const count2026 = contadorFestivos2026[persona] || 0;
                    return {
                        persona,
                        count2025,
                        count2026,
                        total: count2025 + count2026
                    };
                })
                .filter(item => item.total > 0)
                .sort((a, b) => b.total - a.total);
            
            ranking.forEach(({ persona, count2025, count2026, total }) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${persona}</strong></td>
                    <td>${count2025}</td>
                    <td>${count2026}</td>
                    <td><strong>${total}</strong></td>
                `;
                rankingBody.appendChild(row);
            });
            
            if (ranking.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" style="text-align: center; color: #7f8c8d; padding: 20px;">
                        No hay festivos durante guardias
                    </td>
                `;
                rankingBody.appendChild(row);
            }
        }

        function cargarVacaciones() {
            const vacacionesGrid = document.getElementById('vacaciones-grid');
            const mensaje = document.getElementById('vacaciones-message');
            
            vacacionesGrid.innerHTML = '';
            
            // Verificar si hay vacaciones
            let totalVacaciones = 0;
            
            for (const [persona, vacaciones] of Object.entries(VACACIONES)) {
                vacaciones.forEach(([inicio, fin, descripcion]) => {
                    totalVacaciones++;
                    
                    const card = document.createElement('div');
                    card.className = 'vacaciones-card';
                    card.innerHTML = `
                        <div class="vacaciones-date">${formatDate(inicio)} al ${formatDate(fin)}</div>
                        <div class="vacaciones-name"><strong>${persona}</strong></div>
                        <div class="vacaciones-persona">
                            ${descripcion || 'Vacaciones'}
                        </div>
                    `;
                    vacacionesGrid.appendChild(card);
                });
            }
            
            if (totalVacaciones === 0) {
                vacacionesGrid.style.display = 'none';
                mensaje.style.display = 'block';
            } else {
                vacacionesGrid.style.display = 'grid';
                mensaje.style.display = 'none';
            }
        }

        // Inicializar la p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            cargarResumen();
            // Inicializar calendario para el a√±o actual
            if (currentDate.getFullYear() === 2025 || currentDate.getFullYear() === 2026) {
                currentYear = currentDate.getFullYear();
                currentMonth = currentDate.getMonth();
            } else {
                currentYear = 2025;
                currentMonth = 11; // Diciembre 2025
            }
        });
    </script>
</body>
</html>